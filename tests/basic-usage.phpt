--TEST--
Basic usage of Domain51_MicroBench
--FILE--
<?php

require_once dirname(__FILE__) . '/_setup.inc';

$bench = new Domain51_MicroBench();

$file_with_code = dirname(__FILE__) . '/foobar.php';
$bench->loadFromFile($file_with_code);
$bench->save();

$expected_file = dirname(__FILE__) . '/foobar-bench.php';
assert('file_exists($expected_file)');

$date = date(DATE_RFC822);
$expected_code = '<?php
/**
 * Generated by Domain51_MicroBench
 * @date ' . $date . '
 */

/**
 * Start custom setup code
 */
$path = dirname(__FILE__);
$paths = array();

/**
 * End custom setup code
 */

$_Domain51_MicroBench_total = isset($argv[1]) && (int)$argv[1] == $argv[1] ? (int)$argv[1] : 1000;
ob_start();

$_Domain51_MicroBench_start = microtime(true);
for ($i = 0; $i < $_Domain51_MicroBench_total; ++$i) {
    /**
     * Start code to benchmark
     */

    $paths[] = $path;

    /**
     * End code to benchmark
     */
}
$_Domain51_MicroBench_end = microtime(true);


printf(
    "took %s seconds to execute code %s times (%s reqs/second)\n",
    round($_Domain51_MicroBench_end - $_Domain51_MicroBench_start, 5),
    $_Domain51_MicroBench_total,
    round($_Domain51_MicroBench_total / ($_Domain51_MicroBench_end - $_Domain51_MicroBench_start))
);
';

assert('file_get_contents($expected_file) == $expected_code');

?>
===DONE===
--CLEAN--
<?php unlink(dirname(__FILE__) . '/foobar-bench.php'); ?>
--EXPECT--
===DONE===

